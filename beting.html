<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Prediksi 20 Pasaran</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    .tab {
      padding: 8px 12px;
      border-radius: 6px;
      background: #e2e8f0;
      cursor: pointer;
      transition: background 0.3s;
    }
    .tab:hover {
      background: #cbd5e1;
    }
    .tab.active {
      background: #2563eb;
      color: white;
      font-weight: bold;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      text-align: center;
    }
    th {
      background: #f3f4f6;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex">

  <!-- Navbar kiri -->
  <nav class="bg-white w-64 min-h-screen shadow-lg p-6 flex flex-col sticky top-0">
    <h1 class="text-xl font-bold mb-8 text-gray-800">Prediksi 2D ALL PASARAN</h1>
    <ul class="flex flex-col gap-4">
      <li><a href="index.html" class="block px-3 py-2 rounded hover:bg-blue-600 hover:text-white transition">Data 2D</a></li>
      <li><a href="2DAS.html" class="block px-3 py-2 rounded hover:bg-blue-600 hover:text-white transition">2D BBFS AS</a></li>
      <li><a href="Final2d1.html" class="block px-3 py-2 rounded hover:bg-blue-600 hover:text-white transition">2D KEPALA - EKOR</a></li>
      <li><a href="2dshio.html" class="block px-3 py-2 rounded hover:bg-blue-600 hover:text-white transition">2D SHIO MAIN</a></li>
      <li><a href="final2d.html" class="block px-3 py-2 rounded hover:bg-blue-600 hover:text-white transition">REKAP PREDIKSI</a></li>
      <li><a href="beting.html" class="block px-3 py-2 rounded hover:bg-blue-600 hover:text-white transition">Beting Pasaran</a></li>
      <li><a href="kombinasi423d.html" class="block px-3 py-2 rounded hover:bg-blue-600 hover:text-white transition">Kombinasi 423D</a></li>
      <li><a href="3D.html" class="block px-3 py-2 rounded hover:bg-blue-600 hover:text-white transition">Prediksi 3D</a></li>
    </ul>
  </nav>

  <!-- Main Content -->
  <main class="flex-1 p-6">
    <h1 class="text-2xl font-bold mb-6 text-center">Prediksi Pasaran</h1>

    <div class="flex justify-between items-center mb-4">
      <button onclick="refreshData()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
        ðŸ”„ Refresh Data
      </button>
    </div>

    <div id="tabs" class="flex flex-wrap justify-center gap-2 mb-6">Loading pasaran...</div>

    <div id="content" class="bg-white p-6 rounded shadow-lg">
      Pilih pasaran untuk melihat prediksi.
    </div>
  </main>

<script>
  google.charts.load('current', {'packages':['table']});
  google.charts.setOnLoadCallback(loadData);

  const spreadsheetId = '1tX6qfI_0PhrpmGxz4qqaT0_8YHKhPwE3dPHguPvNFmU';
  const sheetName = 'DataPrediksi';

  let allDataTable = null;
  let pasaranAktif = null;

  function loadData() {
    const queryString = encodeURIComponent('SELECT A, B, C, D, E');
    const url = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/gviz/tq?sheet=${sheetName}&tq=${queryString}`;
    const query = new google.visualization.Query(url);
    query.send(response => {
      if (response.isError()) {
        document.getElementById('tabs').textContent = 'Error loading data: ' + response.getMessage();
        return;
      }

      allDataTable = response.getDataTable();
      setupTabsFromData(allDataTable);
    });
  }

  function refreshData() {
    document.getElementById('tabs').innerHTML = 'Memuat ulang...';
    document.getElementById('content').innerHTML = 'Menyegarkan data...';
    loadData();
  }

  function setupTabsFromData(dataTable) {
    const pasaranSet = new Set();
    for (let i = 0; i < dataTable.getNumberOfRows(); i++) {
      pasaranSet.add(dataTable.getValue(i, 0));
    }
    const pasaranList = Array.from(pasaranSet).sort();

    const tabsDiv = document.getElementById('tabs');
    tabsDiv.innerHTML = '';
    pasaranList.forEach(pasaran => {
      const tab = document.createElement('div');
      tab.className = 'tab';
      tab.textContent = pasaran;
      tab.onclick = () => setActiveTab(pasaran, tab);
      tabsDiv.appendChild(tab);
    });

    // Set tab aktif kembali jika sebelumnya sudah ada
    if (pasaranAktif && pasaranList.includes(pasaranAktif)) {
      const tabElement = Array.from(tabsDiv.children).find(tab => tab.textContent === pasaranAktif);
      setActiveTab(pasaranAktif, tabElement);
    } else if (pasaranList.length > 0) {
      setActiveTab(pasaranList[0], tabsDiv.firstChild);
    } else {
      document.getElementById('content').textContent = 'Data pasaran kosong.';
    }
  }

  function setActiveTab(pasaran, clickedTab) {
    pasaranAktif = pasaran;

    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    clickedTab.classList.add('active');

    const filteredRows = [];
    for (let i = 0; i < allDataTable.getNumberOfRows(); i++) {
      if (allDataTable.getValue(i, 0) === pasaran) {
        filteredRows.push({
          nomor: allDataTable.getValue(i, 1)?.toString().trim(),
          prediksi: allDataTable.getValue(i, 2),
          angkaMain: allDataTable.getValue(i, 3)?.toString().replace(/\s+/g, ''),
          bbfs: allDataTable.getValue(i, 4)?.toString().replace(/\s+/g, '')
        });
      }
    }

    let html = `<h2 class="text-lg font-semibold mb-4">Prediksi Pasaran: ${pasaran}</h2>`;
    if (filteredRows.length === 0) {
      html += `<p>Tidak ada data prediksi.</p>`;
    } else {
      html += `<table><thead><tr><th>Nomor</th><th>Prediksi</th><th>Angka Main</th><th>BBFS</th></tr></thead><tbody>`;
      filteredRows.forEach(row => {
        const nomorDigits = row.nomor.split('');
        const angkaMainDigits = row.angkaMain.split('');
        const bbfsDigits = row.bbfs.split('');

        const matchAngkaMain = nomorDigits.some(d => angkaMainDigits.includes(d));
        const matchBBFS = nomorDigits.some(d => bbfsDigits.includes(d));
        const highlight = matchAngkaMain || matchBBFS;

        const prediksiColored = `<span style="color: ${highlight ? 'red' : 'black'}">${row.prediksi}</span>`;
        const angkaMainFormatted = angkaMainDigits.join(' ');
        const bbfsFormatted = bbfsDigits.join(' ');

        html += `<tr>
          <td>${row.nomor}</td>
          <td>${prediksiColored}</td>
          <td>${angkaMainFormatted}</td>
          <td>${bbfsFormatted}</td>
        </tr>`;
      });
      html += `</tbody></table>`;
    }

    document.getElementById('content').innerHTML = html;
  }
</script>

</body>
</html>
