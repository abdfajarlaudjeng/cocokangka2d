<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Filter 2D ON - Jumlah Biji</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <div class="max-w-5xl mx-auto bg-white p-6 rounded shadow-lg">
    <h1 class="text-2xl font-bold mb-4 text-center text-blue-700">Filter 2D ON Berdasarkan Jumlah Biji</h1>

    <div class="flex flex-col sm:flex-row sm:items-center gap-4 mb-6">
      <label for="jumlahSelect" class="font-semibold">Pilih Jumlah:</label>
      <select id="jumlahSelect" class="p-2 border rounded w-60">
        <option value="">-- Semua Jumlah --</option>
        <option value="0">Jumlah 0</option>
        <option value="1">Jumlah 1</option>
        <option value="2">Jumlah 2</option>
        <option value="3">Jumlah 3</option>
        <option value="4">Jumlah 4</option>
        <option value="5">Jumlah 5</option>
        <option value="6">Jumlah 6</option>
        <option value="7">Jumlah 7</option>
        <option value="8">Jumlah 8</option>
        <option value="9">Jumlah 9</option>
      </select>
    </div>

    <div id="hasil" class="overflow-x-auto">
      <p>üîÑ Memuat data prediksi dari spreadsheet...</p>
    </div>
  </div>

<script>
  const jumlah2DON = {
    0: ['7','2','6','9','1','3'],
    1: ['1','4','5','8','3','9'],
    2: ['7','1','0','5','3','6'],
    3: ['9','2','8','3','7','5'],
    4: ['1','7','5','0','9','4'],
    5: ['4','2','7','8','0','3'],
    6: ['6','2','0','4','5','9'],
    7: ['6','2','1','4','7','6'],
    8: ['6','3','0','4','8','9'],
    9: ['0','1','2','5','8','6']
  };

  const spreadsheetId = '1tX6qfI_0PhrpmGxz4qqaT0_8YHKhPwE3dPHguPvNFmU'; // ganti jika perlu
  const sheetName = 'DataPrediksi';
  let semuaData = [];

  google.charts.load('current', {'packages':['table']});
  google.charts.setOnLoadCallback(ambilData);

  function ambilData() {
    const queryString = encodeURIComponent("SELECT A, B, E");
    const url = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/gviz/tq?sheet=${sheetName}&tq=${queryString}`;
    const query = new google.visualization.Query(url);

    query.send(response => {
      if (response.isError()) {
        document.getElementById('hasil').innerHTML = '‚ùå Gagal memuat data: ' + response.getMessage();
        return;
      }

      const data = response.getDataTable();
      semuaData = [];
      for (let i = 0; i < data.getNumberOfRows(); i++) {
        semuaData.push({
          pasaran: data.getValue(i, 0),
          nomor: (data.getValue(i, 1) || '').toString().padStart(2, '0'),
          bbfs: (data.getValue(i, 2) || '').toString().replace(/\s+/g, '')
        });
      }

      tampilkanData();
    });
  }

  function tampilkanData(jumlah = null) {
    const hasil = document.getElementById('hasil');
    let html = `<table class="min-w-full border">
      <thead>
        <tr class="bg-blue-100 text-blue-800">
          <th class="p-2 border">Pasaran</th>
          <th class="p-2 border">Nomor</th>
          <th class="p-2 border">BBFS</th>
        </tr>
      </thead>
      <tbody>`;

    semuaData.forEach(row => {
      const digits = row.nomor.split('');
      const cocok = jumlah !== null
        ? digits.some(d => jumlah2DON[jumlah]?.includes(d))
        : true;

      html += `<tr class="${cocok ? 'bg-green-100 font-bold text-green-800' : 'bg-white'}">
        <td class="border p-2">${row.pasaran}</td>
        <td class="border p-2">${row.nomor}</td>
        <td class="border p-2">${row.bbfs.split('').join(' ')}</td>
      </tr>`;
    });

    html += '</tbody></table>';
    hasil.innerHTML = html;
  }

  document.getElementById('jumlahSelect').addEventListener('change', e => {
    const val = e.target.value;
    tampilkanData(val === "" ? null : val);
  });
</script>
</body>
</html>
